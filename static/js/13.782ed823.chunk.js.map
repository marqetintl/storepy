{"version":3,"sources":["../../../../packages/miq-adminjs/src/settings/GeneralSettingsUpdateView.jsx"],"names":["SettingForm","setting","props","form","useForm","contact_email","ga_tracking","fb_pixel","context","onSubmit","e","preventDefault","oldValues","Object","keys","values","forEach","key","siteServices","patch","slug","then","isUpdated","data","setSetting","catch","err","handleError","Section","title","text","logo_data","onCreate","imgData","logo","className","TextInput","name","type","error","errors","placeholder","Field","label","Submit","value","GeneralSettingsUpdateView","ctx","useContext","SharedDataCtx","useState","settingSlug","site","settings","useEffect","detail","siteForm","domain","patchSite","updateSite","Label","required","disabled","Boolean"],"mappings":"ySAUMA,EAAc,SAAC,GAAgC,IAAD,IAA7BC,eAA6B,MAAnB,GAAmB,EAAZC,EAAY,iBAC5CC,EAAOC,YAAQ,CACnBC,cAAeJ,EAAQI,eAAiB,GACxCC,YAAaL,EAAQK,aAAe,GACpCC,SAAUN,EAAQM,UAAY,KAmBhC,OACE,eAAC,IAAD,CAAMC,QAASL,EAAMM,SAjBF,SAACC,GACpBA,EAAEC,iBAEF,IAAMC,EAAY,GAKlB,OAJAC,OAAOC,KAAKX,EAAKY,QAAQC,SAAQ,SAACC,GAChCL,EAAUK,GAAOhB,EAAQgB,MAGpBC,IACJC,MAAMlB,EAAQmB,KAAMjB,EAAKY,OAAQH,GACjCS,MAAK,YAA6B,IAA1BC,EAAyB,EAAzBA,UAAcC,EAAW,iBAC5BD,GAAWpB,EAAMsB,WAAWD,MAEjCE,OAAM,SAACC,GAAD,OAASvB,EAAKwB,YAAYD,OAInC,UACE,cAAC,IAAUE,QAAX,CAAmBC,MAAM,OAAOC,KAAK,GAArC,SACE,cAAC,IAAD,CACEV,KAAMnB,GAAWA,EAAQ8B,UAAY9B,EAAQ8B,UAAUX,KAAO,KAC9DY,SAAU,SAACC,GAAD,OACRf,IACGC,MAAMlB,EAAQmB,KAAM,CAAEc,KAAMD,EAAQb,OACpCC,MAAK,SAACE,GAAD,OAAUrB,EAAMsB,WAAWD,MAChCE,OAAM,SAACC,QAGZS,UAAU,0BATZ,SAWE,cAAC,IAAD,2BAASlC,EAAQ8B,WAAjB,IAA4BI,UAAU,mBAI1C,cAAC,IAAUP,QAAX,CAAmBC,MAAM,UAAUC,KAAK,sCAAxC,SACE,cAAC,IAAKM,UAAN,CACEC,KAAK,gBACLC,KAAK,QACLC,MAAOpC,EAAKqC,OAAOnC,cACnBoC,YAAY,mCAIhB,cAAC,IAAUb,QAAX,CAAmBC,MAAM,SAASC,KAAK,wCAIvC,eAAC,IAAUF,QAAX,CAAmBC,MAAM,YAAYC,KAAK,gCAA1C,UACE,cAAC,IAAKY,MAAN,CAAYC,MAAM,mCAAlB,SACE,cAAC,IAAKP,UAAN,CAAgBC,KAAK,kBAGvB,cAAC,IAAKK,MAAN,CAAYC,MAAM,iBAAlB,SACE,cAAC,IAAKP,UAAN,CAAgBC,KAAK,eAGvB,qBAAKF,UAAU,GAAf,SACE,cAAC,IAAKS,OAAN,CAAaC,MAAM,OAAOV,UAAU,+BAO/B,SAASW,EAA0B5C,GAChD,IAAM6C,EAAMC,qBAAWC,KACvB,EAA8BC,mBAAS,IAAvC,mBAAOjD,EAAP,KAAgBuB,EAAhB,KAEM2B,EAAcJ,EAAIK,KAAKC,SAE7BC,qBAAU,WACRpC,IACGqC,OAAOJ,GACP9B,MAAK,SAACE,GACAA,EAAKH,MACVI,EAAWD,MAEZE,OAAM,SAACC,SACT,CAACyB,IAEJ,IAAQC,EAASL,EAATK,KACFI,EAAWpD,YAAQ,CAAEiC,KAAMe,EAAKf,KAAMoB,OAAQL,EAAKK,SAEzD,IAAKxD,EAAQmB,KAAM,OAAO,KAsB1B,OACE,eAAC,IAAD,CAAWS,MAAM,wBAAjB,UACE,cAAC,IAAD,CAAMrB,QAASgD,EAAU/C,SAtBR,SAACC,GACpBA,EAAEC,iBACF,IAAQ0C,EAAaD,EAAbC,SAER,GAAKA,EAIL,OAAOnC,IACJwC,UACCL,EACA,CAAEhB,KAAMmB,EAASzC,OAAOsB,KAAMoB,OAAQD,EAASzC,OAAO0C,QACtD,CAAEpB,KAAMe,EAAKf,KAAMoB,OAAQL,EAAKK,SAEjCpC,MAAK,YAA6B,IAA1BC,EAAyB,EAAzBA,UAAcC,EAAW,iBAC5BD,GAAWyB,EAAIY,WAAWpC,EAAK6B,SAEpC3B,OAAM,SAACC,GAAD,OAAS8B,EAAS7B,YAAYD,OAKrC,SACE,eAAC,IAAUE,QAAX,CAAmBC,MAAM,eAAzB,UACE,sBAAKM,UAAU,OAAf,UACE,cAAC,IAAKyB,MAAN,CAAYf,MAAM,cAClB,cAAC,IAAKT,UAAN,CAAgByB,UAAQ,EAACxB,KAAK,OAAOyB,UAAWC,QAAQX,EAAKC,eAG/D,sBAAKlB,UAAU,OAAf,UACE,cAAC,IAAKyB,MAAN,CAAYf,MAAM,gBAClB,cAAC,IAAKT,UAAN,CAAgByB,UAAQ,EAACxB,KAAK,SAASyB,UAAWC,QAAQX,EAAKC,eAGjE,qBAAKlB,UAAU,GAAf,SACE,cAAC,IAAKS,OAAN,CAAaC,MAAM,OAAOV,UAAU,6BAK1C,cAAC,IAAD,CAA2BY,MAAK9C,UAASuB,eAEzC,cAACxB,EAAD,CAAmB+C,MAAK9C,UAASuB","file":"static/js/13.782ed823.chunk.js","sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\n\nimport { SharedDataCtx } from '@miq/contexts';\nimport Form, { useForm } from '@miq/form/';\nimport { ImgUploadButton, Img } from '@miq/components';\n\nimport { AdminView } from '../views';\nimport { siteServices } from './utils';\nimport SiteLiveSettingForm from './GeneralLiveSettingsUpdateSection';\n\nconst SettingForm = ({ setting = {}, ...props }) => {\n  const form = useForm({\n    contact_email: setting.contact_email || '',\n    ga_tracking: setting.ga_tracking || '',\n    fb_pixel: setting.fb_pixel || '',\n  });\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n\n    const oldValues = {};\n    Object.keys(form.values).forEach((key) => {\n      oldValues[key] = setting[key];\n    });\n\n    return siteServices\n      .patch(setting.slug, form.values, oldValues)\n      .then(({ isUpdated, ...data }) => {\n        if (isUpdated) props.setSetting(data);\n      })\n      .catch((err) => form.handleError(err));\n  };\n\n  return (\n    <Form context={form} onSubmit={handleSubmit}>\n      <AdminView.Section title=\"Logo\" text=\"\">\n        <ImgUploadButton\n          slug={setting && setting.logo_data ? setting.logo_data.slug : null}\n          onCreate={(imgData) =>\n            siteServices\n              .patch(setting.slug, { logo: imgData.slug })\n              .then((data) => props.setSetting(data))\n              .catch((err) => {})\n          }\n          // onUpdate={handleCoverUpdate}\n          className=\"site-logo-upload-button\"\n        >\n          <Img {...setting.logo_data} className=\"site-logo\" />\n        </ImgUploadButton>\n      </AdminView.Section>\n\n      <AdminView.Section title=\"Contact\" text=\"What's the best way to contact you?\">\n        <Form.TextInput\n          name=\"contact_email\"\n          type=\"email\"\n          error={form.errors.contact_email}\n          placeholder=\"Write your contact email ...\"\n        />\n      </AdminView.Section>\n\n      <AdminView.Section title=\"Social\" text=\"Display Your social media accounts.\">\n        {/* <Form.TextInput name=\"contact_email\" type=\"url\" placeholder=\"write your instagram url ...\" /> */}\n      </AdminView.Section>\n\n      <AdminView.Section title=\"Analytics\" text=\"Set up third-party analytics.\">\n        <Form.Field label=\"Google Analytics Tracking Number\">\n          <Form.TextInput name=\"ga_tracking\" />\n        </Form.Field>\n\n        <Form.Field label=\"Facebook Pixel\">\n          <Form.TextInput name=\"fb_pixel\" />\n        </Form.Field>\n\n        <div className=\"\">\n          <Form.Submit value=\"Save\" className=\"btn btn-primary-2\" />\n        </div>\n      </AdminView.Section>\n    </Form>\n  );\n};\n\nexport default function GeneralSettingsUpdateView(props) {\n  const ctx = useContext(SharedDataCtx);\n  const [setting, setSetting] = useState({});\n\n  const settingSlug = ctx.site.settings;\n\n  useEffect(() => {\n    siteServices\n      .detail(settingSlug)\n      .then((data) => {\n        if (!data.slug) return;\n        setSetting(data);\n      })\n      .catch((err) => {});\n  }, [settingSlug]);\n\n  const { site } = ctx;\n  const siteForm = useForm({ name: site.name, domain: site.domain });\n\n  if (!setting.slug) return null;\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    const { settings } = site;\n\n    if (!settings) {\n      return;\n    }\n\n    return siteServices\n      .patchSite(\n        settings,\n        { name: siteForm.values.name, domain: siteForm.values.domain },\n        { name: site.name, domain: site.domain }\n      )\n      .then(({ isUpdated, ...data }) => {\n        if (isUpdated) ctx.updateSite(data.site);\n      })\n      .catch((err) => siteForm.handleError(err));\n  };\n\n  return (\n    <AdminView title=\"Site General Settings\">\n      <Form context={siteForm} onSubmit={handleSubmit}>\n        <AdminView.Section title=\"Site Details\">\n          <div className=\"mb-1\">\n            <Form.Label value=\"Site name\" />\n            <Form.TextInput required name=\"name\" disabled={!Boolean(site.settings)} />\n          </div>\n\n          <div className=\"mb-1\">\n            <Form.Label value=\"Site domain\" />\n            <Form.TextInput required name=\"domain\" disabled={!Boolean(site.settings)} />\n          </div>\n\n          <div className=\"\">\n            <Form.Submit value=\"Save\" className=\"btn btn-primary-2\" />\n          </div>\n        </AdminView.Section>\n      </Form>\n\n      <SiteLiveSettingForm {...{ ctx, setting, setSetting }} />\n\n      <SettingForm {...{ ctx, setting, setSetting }} />\n    </AdminView>\n  );\n}\n"],"sourceRoot":""}