{"version":3,"sources":["../../../../packages/miq-adminjs/src/settings/GeneralSettingsUpdateView.jsx"],"names":["GeneralSettingsUpdateView","props","toast","useContext","ToastCtx","ctx","SharedDataCtx","useState","setting","setSetting","site","form","useForm","name","domain","contact_email","ga_tracking","fb_pixel","settingSlug","settings","siteName","siteDomain","setValues","useEffect","siteServices","detail","then","data","slug","catch","err","title","className","context","onSubmit","e","preventDefault","patchSite","values","isUpdated","updateSite","success","message","handleError","Section","Label","value","TextInput","required","error","errors","disabled","Boolean","Submit","logo_data","onCreate","imgData","patch","logo","onUpdate","oldValues","Object","keys","forEach","key","text","type","placeholder","Field","label"],"mappings":"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","file":"static/js/17.59b076b9.chunk.js","sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\n\nimport { SharedDataCtx } from '@miq/contexts';\nimport Form, { useForm } from '@miq/form/';\nimport { ImgUploadButton, Img, ToastCtx } from '@miq/components';\n\nimport { AdminView } from '../views';\nimport { siteServices } from './utils';\nimport SiteLiveSettingForm from './GeneralLiveSettingsUpdateSection';\n\nexport default function GeneralSettingsUpdateView(props) {\n  const toast = useContext(ToastCtx);\n  const ctx = useContext(SharedDataCtx);\n  const [setting, setSetting] = useState({});\n\n  const { site = {} } = ctx;\n\n  const form = useForm({\n    name: site.name,\n    domain: site.domain,\n    contact_email: setting.contact_email || '',\n    ga_tracking: setting.ga_tracking || '',\n    fb_pixel: setting.fb_pixel || '',\n  });\n\n  const settingSlug = site.settings;\n  const siteName = site?.name;\n  const siteDomain = site?.domain;\n  const setValues = form.setValues;\n\n  useEffect(() => {\n    siteServices\n      .detail(settingSlug)\n      .then((data) => {\n        if (!data.slug) return;\n        setSetting(data);\n        setValues({\n          name: siteName || '',\n          domain: siteDomain || '',\n          contact_email: data.contact_email || '',\n          ga_tracking: data.ga_tracking || '',\n          fb_pixel: data.fb_pixel || '',\n        });\n      })\n      .catch((err) => {});\n  }, [settingSlug, setValues, siteName, siteDomain]);\n\n  if (!setting.slug) return null;\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    return siteServices\n      .patchSite(\n        settingSlug,\n        { name: form.values.name, domain: form.values.domain },\n        { name: site.name, domain: site.domain }\n      )\n      .then(({ isUpdated, ...data }) => {\n        if (isUpdated) {\n          ctx.updateSite(data.site);\n          toast.success({ message: 'Site updated.' });\n        }\n      })\n      .catch((err) => form.handleError(err));\n  };\n\n  return (\n    <AdminView title=\"Site General Settings\">\n      <div className=\"d-grid grid-md-4 gap-2\">\n        <Form context={form} onSubmit={handleSubmit} className=\"span-md-3\">\n          <AdminView.Section title=\"Site Details\">\n            <div className=\"mb-1\">\n              <Form.Label value=\"Site name\" />\n              <Form.TextInput required name=\"name\" error={form.errors.name} disabled={!Boolean(site.settings)} />\n            </div>\n\n            <div className=\"mb-1\">\n              <Form.Label value=\"Site domain\" />\n              <Form.TextInput required name=\"domain\" error={form.errors.domain} disabled={!Boolean(site.settings)} />\n            </div>\n\n            <div className=\"\">\n              <Form.Submit value=\"Save\" className=\"btn btn-primary-2\" />\n            </div>\n          </AdminView.Section>\n        </Form>\n\n        <AdminView.Section title=\"Site logo\" className=\"span-md-1\">\n          <ImgUploadButton\n            slug={setting && setting.logo_data ? setting.logo_data.slug : null}\n            onCreate={(imgData) =>\n              siteServices\n                .patch(setting.slug, { logo: imgData.slug })\n                .then((data) => {\n                  setSetting(data);\n                  toast.success({ message: 'Logo added.' });\n                })\n                .catch((err) => {})\n            }\n            onUpdate={(imgData) => {\n              setSetting({ ...setting, logo_data: imgData });\n              toast.success({ message: 'Logo updated.' });\n            }}\n            className=\"site-logo-upload-button\"\n          >\n            <Img {...setting.logo_data} className=\"site-logo\" />\n          </ImgUploadButton>\n        </AdminView.Section>\n      </div>\n\n      <SiteLiveSettingForm {...{ ctx, setting, setSetting, toast }} />\n\n      <Form\n        context={form}\n        onSubmit={(e) => {\n          e.preventDefault();\n\n          const oldValues = {};\n          Object.keys(form.values).forEach((key) => {\n            oldValues[key] = setting[key];\n          });\n\n          return siteServices\n            .patch(setting.slug, form.values, oldValues)\n            .then(({ isUpdated, ...data }) => {\n              if (isUpdated) {\n                setSetting && setSetting(data);\n                toast && toast.success({ message: 'Site updated.' });\n              }\n            })\n            .catch((err) => form.handleError(err));\n        }}\n        className=\"d-grid grid-md-2 gap-2\"\n      >\n        <AdminView.Section\n          title=\"Contact\"\n          text=\"What's the best way to contact you?\"\n          // className=\"span-md-1\"\n        >\n          <Form.TextInput\n            name=\"contact_email\"\n            type=\"email\"\n            error={form.errors.contact_email}\n            placeholder=\"Write your contact email ...\"\n          />\n        </AdminView.Section>\n\n        <AdminView.Section title=\"Social\" text=\"Display Your social media accounts.\" className=\"span-md-1\" />\n\n        <AdminView.Section title=\"Analytics\" text=\"Set up third-party analytics.\" className=\"span-md-2\">\n          <Form.Field label=\"Google Analytics Tracking Number\">\n            <Form.TextInput name=\"ga_tracking\" error={form.errors.ga_tracking} />\n          </Form.Field>\n\n          <Form.Field label=\"Facebook Pixel\">\n            <Form.TextInput name=\"fb_pixel\" error={form.errors.fb_pixel} />\n          </Form.Field>\n\n          <div className=\"\">\n            <Form.Submit value=\"Save\" className=\"btn btn-primary-2\" />\n          </div>\n        </AdminView.Section>\n      </Form>\n    </AdminView>\n  );\n}\n"],"sourceRoot":""}