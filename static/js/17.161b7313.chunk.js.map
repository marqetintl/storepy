{"version":3,"sources":["../../../../packages/miq-adminjs/src/settings/GeneralSettingsUpdateView.jsx"],"names":["SettingForm","setting","props","form","useForm","contact_email","ga_tracking","fb_pixel","toast","setSetting","context","onSubmit","e","preventDefault","oldValues","Object","keys","values","forEach","key","siteServices","patch","slug","then","isUpdated","data","success","message","catch","err","handleError","Section","title","text","logo_data","onCreate","imgData","logo","onUpdate","className","TextInput","name","type","error","errors","placeholder","Field","label","Submit","value","GeneralSettingsUpdateView","useContext","ToastCtx","ctx","SharedDataCtx","useState","site","siteForm","domain","settingSlug","settings","useEffect","detail","patchSite","updateSite","Label","required","disabled","Boolean"],"mappings":"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","file":"static/js/17.161b7313.chunk.js","sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\n\nimport { SharedDataCtx } from '@miq/contexts';\nimport Form, { useForm } from '@miq/form/';\nimport { ImgUploadButton, Img, ToastCtx } from '@miq/components';\n\nimport { AdminView } from '../views';\nimport { siteServices } from './utils';\nimport SiteLiveSettingForm from './GeneralLiveSettingsUpdateSection';\n\nconst SettingForm = ({ setting = {}, ...props }) => {\n  const form = useForm({\n    contact_email: setting.contact_email || '',\n    ga_tracking: setting.ga_tracking || '',\n    fb_pixel: setting.fb_pixel || '',\n  });\n\n  const { toast, setSetting } = props;\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n\n    const oldValues = {};\n    Object.keys(form.values).forEach((key) => {\n      oldValues[key] = setting[key];\n    });\n\n    return siteServices\n      .patch(setting.slug, form.values, oldValues)\n      .then(({ isUpdated, ...data }) => {\n        if (isUpdated) {\n          setSetting && setSetting(data);\n          toast && toast.success({ message: 'Site updated.' });\n        }\n      })\n      .catch((err) => form.handleError(err));\n  };\n\n  return (\n    <Form context={form} onSubmit={handleSubmit}>\n      <AdminView.Section title=\"Logo\" text=\"\">\n        <ImgUploadButton\n          slug={setting && setting.logo_data ? setting.logo_data.slug : null}\n          onCreate={(imgData) =>\n            siteServices\n              .patch(setting.slug, { logo: imgData.slug })\n              .then((data) => {\n                setSetting(data);\n                toast.success({ message: 'Logo added.' });\n              })\n              .catch((err) => {})\n          }\n          onUpdate={(imgData) => {\n            setSetting({ ...setting, logo_data: imgData });\n            toast.success({ message: 'Logo updated.' });\n          }}\n          className=\"site-logo-upload-button\"\n        >\n          <Img {...setting.logo_data} className=\"site-logo\" />\n        </ImgUploadButton>\n      </AdminView.Section>\n\n      <AdminView.Section title=\"Contact\" text=\"What's the best way to contact you?\">\n        <Form.TextInput\n          name=\"contact_email\"\n          type=\"email\"\n          error={form.errors.contact_email}\n          placeholder=\"Write your contact email ...\"\n        />\n      </AdminView.Section>\n\n      <AdminView.Section title=\"Social\" text=\"Display Your social media accounts.\">\n        {/* <Form.TextInput name=\"contact_email\" type=\"url\" placeholder=\"write your instagram url ...\" /> */}\n      </AdminView.Section>\n\n      <AdminView.Section title=\"Analytics\" text=\"Set up third-party analytics.\">\n        <Form.Field label=\"Google Analytics Tracking Number\">\n          <Form.TextInput name=\"ga_tracking\" error={form.errors.ga_tracking} />\n        </Form.Field>\n\n        <Form.Field label=\"Facebook Pixel\">\n          <Form.TextInput name=\"fb_pixel\" error={form.errors.fb_pixel} />\n        </Form.Field>\n\n        <div className=\"\">\n          <Form.Submit value=\"Save\" className=\"btn btn-primary-2\" />\n        </div>\n      </AdminView.Section>\n    </Form>\n  );\n};\n\nexport default function GeneralSettingsUpdateView(props) {\n  const toast = useContext(ToastCtx);\n  const ctx = useContext(SharedDataCtx);\n  const [setting, setSetting] = useState({});\n\n  const { site = {} } = ctx;\n\n  const siteForm = useForm({ name: site.name, domain: site.domain });\n\n  const settingSlug = site.settings;\n\n  useEffect(() => {\n    siteServices\n      .detail(settingSlug)\n      .then((data) => {\n        if (!data.slug) return;\n        setSetting(data);\n      })\n      .catch((err) => {});\n  }, [settingSlug]);\n\n  if (!setting.slug) return null;\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    const { settings } = site;\n\n    if (!settings) {\n      return;\n    }\n\n    return siteServices\n      .patchSite(\n        settings,\n        { name: siteForm.values.name, domain: siteForm.values.domain },\n        { name: site.name, domain: site.domain }\n      )\n      .then(({ isUpdated, ...data }) => {\n        if (isUpdated) {\n          ctx.updateSite(data.site);\n          toast.success({ message: 'Site updated.' });\n        }\n      })\n      .catch((err) => siteForm.handleError(err));\n  };\n\n  return (\n    <AdminView title=\"Site General Settings\">\n      <Form context={siteForm} onSubmit={handleSubmit}>\n        <AdminView.Section title=\"Site Details\">\n          <div className=\"mb-1\">\n            <Form.Label value=\"Site name\" />\n            <Form.TextInput required name=\"name\" error={siteForm.errors.name} disabled={!Boolean(site.settings)} />\n          </div>\n\n          <div className=\"mb-1\">\n            <Form.Label value=\"Site domain\" />\n            <Form.TextInput required name=\"domain\" error={siteForm.errors.domain} disabled={!Boolean(site.settings)} />\n          </div>\n\n          <div className=\"\">\n            <Form.Submit value=\"Save\" className=\"btn btn-primary-2\" />\n          </div>\n        </AdminView.Section>\n      </Form>\n\n      <SiteLiveSettingForm {...{ ctx, setting, setSetting, toast }} />\n\n      <SettingForm {...{ ctx, setting, setSetting, toast }} />\n    </AdminView>\n  );\n}\n"],"sourceRoot":""}